<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.freedy.backend.dao.ArticleDao">

	<!-- 可根据自己的需求，是否要使用 -->
    <resultMap type="com.freedy.backend.entity.ArticleEntity" id="articleMap">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="articleDesc" column="article_desc"/>
        <result property="authorName" column="author_id"/>
        <result property="articlePoster" column="article_poster"/>
        <result property="content" column="content"/>
        <result property="visitNum" column="visit_num"/>
        <result property="commentNum" column="comment_num"/>
        <result property="likeNum" column="like_num"/>
        <result property="articleStatus" column="article_status"/>
        <result property="articleCategoryId" column="article_category_id"/>
        <result property="createTime" column="create_time"/>
        <result property="updateTime" column="update_time"/>
    </resultMap>

    <resultMap id="ArticleInfoMap" type="com.freedy.backend.entity.vo.ArticleInfoVo" autoMapping="true">
        <result property="id" column="id"/>
        <result property="title" column="title"/>
        <result property="articleStatus" column="article_status"/>
        <result property="articleCategory" column="category_name"/>
        <result property="articleDesc" column="article_desc"/>
        <result property="visitNum" column="visit_num"/>
        <result property="commentNum" column="comment_num"/>
        <result property="likeNum" column="like_num"/>
        <result property="authorName" column="author_name"/>
        <result property="updateTime" column="update_time"/>
        <collection property="articleTags" javaType="list" ofType="string">
            <result column="tag_name"/>
        </collection>
    </resultMap>

    <select id="queryArticleList"
            resultMap="ArticleInfoMap"
            parameterType="com.freedy.backend.common.utils.PageUtils">
        <bind name="key_offset" value="(currPage-1)*pageSize"></bind>
        select article.id,article.title,article.article_status,category.category_name,
               article.article_desc,article.comment_num,article.visit_num,article.like_num,
               article.author_id,article.publish_time,article.update_time,tag.tag_name
        from (select * from blog_article limit #{key_offset},#{pageSize} )as article
                 left join blog_category as category on article.article_category_id=category.id
                 left join blog_article_tag_relation relation on article.id = relation.article_id
                 left join blog_tag tag on tag.id = relation.tag_id
    </select>

    <select id="getCount" resultType="java.lang.Long">
        select count(*) from blog_article;
    </select>
    <select id="getTotalVisit" resultType="java.lang.Long">
        select sum(visit_num) from blog_article where author_id=#{authorId}
    </select>
    <select id="getTotalComment" resultType="java.lang.Long">
        select sum(comment_num) from blog_article where author_id=#{authorId}
    </select>


</mapper>