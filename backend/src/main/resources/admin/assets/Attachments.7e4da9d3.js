import{d as e,o as t,c as l,F as s,K as a,b as n,e as o,p as c,a as i,v as r,G as u,r as d,H as m,h as p,u as f,I as g,i as v,T as y,q as h,s as w,D as k,x as _}from"./vendor.d4f367cf.js";import{g as b,a as C,p as x}from"./http.a8f0cc34.js";import{_ as I}from"./Upload.4cd4b938.js";import{_ as T}from"./FullScreen.d7e9a6db.js";import"./index.a8427317.js";c("data-v-1095b9fb");const E={class:"container"},S={key:0,class:"loader"},B={key:1,style:{margin:"auto",color:"#909090"}};i();var j=e({expose:[],props:["hasMore"],setup:e=>(c,i)=>(t(),l("div",E,[e.hasMore?(t(),l("div",S,[(t(),l(s,null,a(5,(e=>n("div",{class:"dot",key:e}))),64))])):o("",!0),e.hasMore?o("",!0):(t(),l("div",B,"没有更多了😭😭~~"))]))});j.__scopeId="data-v-1095b9fb";const D=h();c("data-v-4593683e");const H={class:"root"},L={class:"btn-area"},N={class:"switch-btn"},V={key:0,class:"ops-btn"},q=w("上传"),M=w("删除"),U={class:"img-area"},F={class:"checked"},$=n("div",{class:"loading"},null,-1),z={class:"button-area"},W=n("i",{class:"el-icon-close"},null,-1),A=n("i",{class:"el-icon-arrow-left"},null,-1),G=n("i",{class:"el-icon-arrow-right"},null,-1);i();var K=e({expose:[],setup(c){const{proxy:i}=_();let h;e({LoadMore:j,Upload:I,FullScreen:T});let w=(new Date).getTime();r((()=>{const e=localStorage.getItem("switchValue");e&&(Y.value="0"===e),ie().then((()=>{setTimeout((()=>{re();const e=document.querySelector("#content");window.onresize=()=>re(),e.onscroll=e=>{(new Date).getTime()-w>50&&K(e)}}),500),h=setInterval((()=>{re()}),1e3)}))})),u((()=>{clearInterval(h)}));let E,S,B=d(!0),K=({srcElement:e})=>{e.scrollTop+e.clientHeight>e.scrollHeight-50&&B.value&&(oe++,ie())},O=d(!1);async function P(){S||(S=1,E&&clearTimeout(E),E=setTimeout((()=>{ce.length=0,oe=1,ie().then(),S=null}),1e3))}let J,Q,R=[],X=d(!1),Y=d(!1);function Z(){te(C(ae(ce[Q-1<=0?0:--Q])))}function ee(){te(C(ae(ce[Q+1>=ce.length-1?ce.length-1:++Q])))}function te(e){const t=document.querySelector(".full-screen-image");t.style.opacity="0",t.style.width="0",t.style.height="0",setTimeout((()=>{let l=setInterval((function(){t.complete&&(t.style.opacity="1",t.style.width="85vw",t.style.height="95vh",clearInterval(l))}),50);se.value=e}),500)}u((()=>{localStorage.setItem("switchValue",Y.value?"0":"1")}));let le=d(!1),se=d("");function ae(e){if(e.match(/\?x-oss-process/))return e.split("?x-oss-process")[0];if(e.match(/\/image\//)){let t=e.split("-",5);return t[0]+"-"+t[1]+"-"+t[2]+"-"+t[4]}throw new Error("转换失败")}async function ne(){let e=[];R.forEach((t=>e.push(ce[t])));const t=await x("/file/delPic",e);if(200==t.code){i.$notify({message:t.data});const e=document.getElementsByClassName("item"),l=document.getElementsByClassName("checked");R.forEach((t=>{e[t].classList.remove("select"),l[t].style.display="none"})),R=[],ce.length=0,oe=1,ie().then()}else i.$notify.error({title:"出差啦😢！",message:t.msg,duration:5e3})}let oe=1,ce=m([]);async function ie(){const e=await b(`/file/getImages?page=${oe}&limit=30&sidx=id&order=desc`);if(200==e.code){const t=e.data.list;0==t.length&&(B.value=!1),t.forEach(((e,t)=>{ce.push(e.resourceUrl)}))}}function re(){let e=document.getElementsByClassName("item");if(0===e.length)return;let t=document.querySelector("#content").clientWidth-50,l=e[0].offsetWidth,s=parseInt(String(t/(l+10))),a=[];for(let n=0;n<e.length;n++)if(n<s)e[n].style.top=0,e[n].style.left=(l+10)*n+"px",a.push(e[n].offsetHeight);else{let t=a[0],l=0;for(let e=0;e<a.length;e++)t>a[e]&&(t=a[e],l=e);e[n].style.top=a[l]+10+"px",e[n].style.left=e[l].offsetLeft+"px",a[l]=a[l]+e[n].offsetHeight+10}}return(e,c)=>{const i=p("el-switch"),r=p("el-button"),u=p("el-image");return t(),l("div",H,[n("div",L,[n("div",N,[n(i,{style:{display:"block"},modelValue:f(Y),"onUpdate:modelValue":c[1]||(c[1]=e=>g(Y)?Y.value=e:Y=e),"active-color":"rgb(243 119 119)","inactive-color":"rgb(11 191 226)","active-text":"复制链接","inactive-text":"操作图片"},null,8,["modelValue"])]),n(v,{name:"el-fade-in-linear"},{default:D((()=>[f(Y)?o("",!0):(t(),l("div",V,[n(r,{type:"primary",onClick:c[2]||(c[2]=e=>g(O)?O.value=!0:O=!0)},{default:D((()=>[q])),_:1}),n(r,{type:"danger",onClick:ne},{default:D((()=>[M])),_:1})]))])),_:1})]),n("div",U,[(t(!0),l(s,null,a(f(ce),((e,s)=>(t(),l("div",{class:"item",onClick:e=>function(e,t){if(J?(new Date).getTime()-J<200&&(le.value=!0,setTimeout((()=>{te(C(ae(ce[t])))}),300),Q=t,J=null):(J=(new Date).getTime(),setTimeout((()=>{J=null}),300)),Y.value)try{let e=document.createElement("input");e.value=C(ae(ce[t])),e.style.opacity="0",e.setAttribute("name","secukey"),document.body.appendChild(e),e.select(),document.execCommand("Copy"),e.id="oInput",e.remove(),k.success({message:"复制成功!",type:"success"})}catch(l){console.log(l),k.error("url转换失败!")}else{const e=document.getElementsByClassName("item")[t],l=document.getElementsByClassName("checked")[t];let s;-1==(s=R.indexOf(t))?(R.push(t),e.classList.add("select"),l.style.display="block",X.value=!0):(R.splice(s,1),e.classList.remove("select"),l.style.display="none",X.value=R.length>0)}}(0,s),key:e},[n("div",F,[n("img",{src:f("/admin/assets/check.a3d3306e.svg"),alt:""},null,8,["src"])]),n(u,{key:e,src:f(C)(e),lazy:""},null,8,["src"])],8,["onClick"])))),128))]),(t(),l(y,{to:"body"},[n(v,{name:"el-fade-in-linear"},{default:D((()=>[f(O)?(t(),l(I,{key:0,onClick:c[3]||(c[3]=e=>g(O)?O.value=!1:O=!1),onSuccessCB:P})):o("",!0)])),_:1})])),(t(),l(y,{to:"body"},[n(v,{name:"el-fade-in-linear"},{default:D((()=>[f(le)?(t(),l(T,{key:0,opacity:"0.3",onClick:c[5]||(c[5]=e=>g(le)?le.value=!1:le=!1)},{default:D((()=>[n("img",{class:"full-screen-image",src:f(se),alt:""},null,8,["src"]),$,n("div",z,[n("span",{class:"el-image-viewer__btn el-image-viewer__close",onClick:c[4]||(c[4]=e=>g(le)?le.value=!1:le=!1)},[W]),n("span",{class:"el-image-viewer__btn el-image-viewer__prev",onClick:Z},[A]),n("span",{class:"el-image-viewer__btn el-image-viewer__next",onClick:ee},[G])])])),_:1})):o("",!0)])),_:1})]))])}}});K.__scopeId="data-v-4593683e";export default K;
