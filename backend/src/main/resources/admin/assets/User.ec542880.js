import{d as e,f as l,g as t,r as a,G as s,v as n,h as i,o,c as r,b as m,u,e as c,C as d,I as p,B as g,F as f,K as h,i as y,q as w,p as P,s as k,a as v,x as I}from"./vendor.7ce22028.js";import{g as b,a as V,p as C}from"./http.c8a04791.js";import{_}from"./ImgDrawer.2905be4e.js";import{_ as x}from"./FullScreen.6c2fcf19.js";import{c as U,a as A}from"./Common.e16055f9.js";import"./index.455f64ef.js";const $=w();P("data-v-3f220e2a");const j={class:"root"},E={class:"index-container"},D={class:"info"},q={key:0,class:"name"},M={class:"name"},F={class:"introduce"},N={class:"item"},z=m("i",{class:"el-icon-ice-cream-round"},null,-1),O={href:"#",style:{color:"#0b9aff","text-decoration":"none"}},T={class:"item"},H=m("i",{class:"el-icon-ice-cream-square"},null,-1),R={class:"item"},S=m("i",{class:"el-icon-lollipop"},null,-1),B=m("i",{class:"el-icon-edit"},null,-1),G={class:"statistics"},K=m("h1",null,"个人资料",-1),J=k("保存"),L=k("提交"),Q=k("重置"),W=m("i",{class:"el-icon-circle-plus-outline",style:{"margin-right":"5px"}},null,-1),X=m("span",null,"添加一个",-1),Y={class:"expand"},Z={class:"info"},ee={class:"photo"},le={class:"name"},te={class:"introduce"},ae={class:"item email"},se=m("i",{class:"el-icon-ice-cream-square"},null,-1),ne={class:"item email"},ie=m("i",{class:"el-icon-ice-cream-square"},null,-1),oe={class:"item text"},re=m("span",null,"个人介绍",-1),me={class:"newUserForm"},ue={class:"item"},ce=m("span",null,"用户名:",-1),de={class:"item"},pe=m("span",null,"密码:",-1),ge={class:"item"},fe=m("span",null,"邮箱:",-1),he={key:0,class:"permission item"},ye=m("div",{style:{width:"100%"}},[m("p",{style:{"margin-left":"10px"}},"权限:")],-1),we={class:"permissionContainer"},Pe=m("span",null,"文章:",-1),ke={class:"article line"},ve={style:{display:"flex","justify-content":"space-between"}},Ie=k("全选 "),be=m("span",null,"评论:",-1),Ve={class:"user line"},Ce={style:{display:"flex","justify-content":"space-between"}},_e=k("全选 "),xe=m("span",null,"用户:",-1),Ue={class:"user line"},Ae={style:{display:"flex","justify-content":"space-between"}},$e=k("全选 "),je=m("span",null,"设置:",-1),Ee={class:"setting line"},De={style:{display:"flex","justify-content":"space-between"}},qe=k("全选 "),Me={class:"item"},Fe=k("保存 "),Ne=k("取消"),ze={style:{color:"#ff268b","margin-left":"20px",width:"100%"}};v();var Oe=e({expose:[],setup(w){const P=l(),k=t(),{proxy:v}=I();e({ImgDrawer:_,FullScreen:x});let Oe=a(!1);function Te(){Oe.value=!Oe.value}async function He(e){const l=await C("/manager/updateUserInfo",{headImg:e,username:Je.username});200==l.code?(Le().then(),P.commit("notifyReloadNickNameAndHeadImg")):v.$notify.error({title:"出差啦😢！",message:l.msg})}let Re=s({username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:5,max:20,message:"用户名长度在 5 到 20 个字符",trigger:"blur"}],nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"},{min:5,max:30,message:"昵称长度在 8 到 30 个字符！",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]}),Se=s({oldPass:"",pass:"",checkPass:""}),Be=s({oldPass:[{validator:Ge,trigger:"blur"}],pass:[{validator:Ge,trigger:"blur"}],checkPass:[{validator:function(e,l,t){Se.pass==Se.checkPass?t():t(new Error("两次输入密码不一致!"))},trigger:"blur"}]});function Ge(e,l,t){""!=l?t():t(new Error("请输入密码！"))}function Ke(){Se.pass="",Se.checkPass=""}let Je=s({username:"",nickname:"",email:"",introduce:"",headImg:null,rootAdmin:!1,pageUrl:"",createDuration:"",totalArticle:0,totalCategory:0,totalTags:0,totalComment:0,totalVisit:0});n((async()=>{Le().then()}));async function Le(){const e=await b("/manager/getUserInfo");if(200==e.code){const l=e.data;U(l,Je)}else v.$notify.error({title:"出差啦😢！",message:e.msg})}let Qe=a();function We(){Qe.value.validate((e=>{if(!e)return console.log("error submit!!"),!1;!async function(){const e=await C("/manager/updateUserInfo",{username:Je.username,nickname:Je.nickname,email:Je.email,introduce:Je.introduce});2002==e.code?(v.$notify({title:"成功",message:"修改成功，请重新登录!",type:"success"}),await k.push("/login")):200==e.code?(P.commit("notifyReloadNickNameAndHeadImg"),v.$notify({title:"成功",message:"修改成功!",type:"success"})):v.$notify.error({title:"出差啦😢！",message:e.msg})}()}))}let Xe=a();function Ye(){Xe.value.validate((async e=>{if(!e)return console.log("error submit!!"),!1;{const e=await C("/manager/updateUserPassword",{oldPassword:Se.oldPass,newPassword:Se.checkPass});2002==e.code?(v.$notify({title:"成功",message:"修改成功，请重新登录!",type:"success"}),await k.push("/login")):v.$notify.error({title:"出差啦😢！",message:e.msg})}}))}let Ze=s([]),el=a("first");function ll(){"third"==el.value&&(Ze.length=0,tl())}async function tl(){const e=await b("/manager/list??page=1&limit=20");if(200==e.code){e.page.list.forEach(((e,l)=>{Ze.push({id:e.id,username:e.username,nickname:e.nickname,headImg:e.headImg,email:e.email,createDuration:e.createDuration,introduce:e.introduce,status:e.status})}))}else v.$notify.error({title:"出差啦😢！",message:e.msg})}let al=a(!1),sl=s({articlePermission:[],commentPermission:[],userPermission:[],settingPermission:[],isManager:!1});async function nl(){null!=il.id&&(il.id=null,il.username="",il.password=null,il.email="",il.articlePermission=[],il.commentPermission=[],il.settingPermission=[],il.userPermission=[],Object.keys(ol).forEach((e=>ol[e]=!1)));const e=await b("/rolePermission/getPermissionItem");if(200==e.code){al.value=!0;const l=e.data;U(l,sl)}else v.$notify.error({title:"出差啦😢！",message:e.msg})}let il=s({id:null,username:null,password:null,email:null,articlePermission:[],commentPermission:[],userPermission:[],settingPermission:[]}),ol=s({articleCheckAll:!1,commentCheckAll:!1,userCheckAll:!1,settingCheckAll:!1,articleIsIndeterminate:!1,commentIsIndeterminate:!1,userIsIndeterminate:!1,settingIsIndeterminate:!1});function rl(e){il.articlePermission=e?sl.articlePermission:[],ol.articleIsIndeterminate=!1}function ml(e){il.commentPermission=e?sl.commentPermission:[],ol.commentIsIndeterminate=!1}function ul(e){il.userPermission=e?sl.userPermission:[],ol.userIsIndeterminate=!1}function cl(e){il.settingPermission=e?sl.settingPermission:[],ol.settingIsIndeterminate=!1}function dl(e){let l=e.length;ol.articleCheckAll=l===sl.articlePermission.length,ol.articleIsIndeterminate=l>0&&l<sl.articlePermission.length}function pl(e){let l=e.length;ol.commentCheckAll=l===sl.commentPermission.length,ol.commentIsIndeterminate=l>0&&l<sl.commentPermission.length}function gl(e){let l=e.length;ol.userCheckAll=l===sl.userPermission.length,ol.userIsIndeterminate=l>0&&l<sl.userPermission.length}function fl(e){let l=e.length;ol.settingCheckAll=l===sl.settingPermission.length,ol.settingIsIndeterminate=l>0&&l<sl.settingPermission.length}let hl=a("");async function yl(){try{!function(){if(null!=il.id){if(null!=il.password&&(il.password.length<8||il.password.length>20))throw hl.value="密码长度在 8 到 20 个字符！",new Error;if(!il.email.match("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"))throw hl.value="邮箱格式不正确~~ 😥😥",new Error}else{if(!(wl(il.username)&&wl(il.email)&&wl(il.password)))throw hl.value="用户名密码邮箱都不能为空哦！",new Error;if(il.username.length<5||il.username.length>20)throw hl.value="用户名长度在 5 到 20 个字符！",new Error;if(il.password.length<8||il.password.length>20)throw hl.value="密码长度在 8 到 20 个字符！",new Error;if(!il.email.match("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"))throw hl.value="邮箱格式不正确~~ 😥😥",new Error}}();const e=await C("/manager/createOrUpdateManager",il);200==e.code?(v.$notify({title:"成功",message:"操作成功！",type:"success"}),Ze.length=0,tl().then(),al.value=!1,il.id=null,il.username=null,il.password=null,il.email=null,il.articlePermission=[],il.commentPermission=[],il.userPermission=[],il.settingPermission=[]):2002==e.code?(v.$notify({title:"成功",message:"修改成功，请重新登录!",type:"success"}),await k.push("/login")):v.$notify.error({title:"出差啦😢！",message:e.msg,duration:5e3})}catch(e){}}function wl(e){return null!=e&&e.length>0}return(e,l)=>{const t=i("el-divider"),a=i("el-card"),s=i("el-input"),n=i("el-form-item"),w=i("el-button"),P=i("el-form"),k=i("el-tab-pane"),I=i("el-table-column"),C=i("el-tooltip"),U=i("el-table"),Ge=i("el-tabs"),Le=i("el-checkbox"),wl=i("el-checkbox-group");return o(),r("div",j,[m("div",E,[m(a,{class:"box-card left"},{default:$((()=>[m("div",D,[m("div",{class:"photo",onClick:Te,style:{cursor:"pointer"}},[m("img",{src:u(V)(u(Je).headImg),alt:""},null,8,["src"])]),u(Je).rootAdmin?(o(),r("p",q,"Admin")):c("",!0),m("p",M,d(u(Je).nickname),1)]),m("div",F,[m("div",N,[z,m("a",O," http://localhost:3000"+d(u(Je).pageUrl),1)]),m("div",T,[H,m("p",null,d(u(Je).email),1)]),m("div",R,[S,m("p",null,d(u(Je).createDuration),1)])]),m(t,null,{default:$((()=>[B])),_:1}),m("div",G,[m("p",null,"累计发表了 "+d(u(Je).totalArticle)+" 篇文章。",1),m(t),m("p",null,"累计创建了 "+d(u(Je).totalCategory)+" 个分类。",1),m(t),m("p",null,"累计创建了 "+d(u(Je).totalTags)+" 个标签。",1),m(t),m("p",null,"累计获得了 "+d(u(Je).totalComment)+" 条评论。",1),m(t),m("p",null,"文章总阅读 "+d(u(Je).totalVisit)+" 次。",1),m(t)])])),_:1}),m(a,{class:"box-card right"},{default:$((()=>[K,m(Ge,{modelValue:u(el),"onUpdate:modelValue":l[8]||(l[8]=e=>p(el)?el.value=e:el=e),onTabClick:ll},{default:$((()=>[m(k,{label:"基本资料",name:"first"},{default:$((()=>[m(P,{ref:Qe,model:u(Je),rules:u(Re)},{default:$((()=>[m(n,{label:"登录用户名",prop:"username",style:{"margin-bottom":"15px"}},{default:$((()=>[m(s,{modelValue:u(Je).username,"onUpdate:modelValue":l[1]||(l[1]=e=>u(Je).username=e)},null,8,["modelValue"])])),_:1}),m(n,{label:"昵称 (不建议经常更改,可能会影响性能)",prop:"nickname",style:{"margin-bottom":"15px"}},{default:$((()=>[m(s,{modelValue:u(Je).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>u(Je).nickname=e)},null,8,["modelValue"])])),_:1}),m(n,{label:"电子邮件",prop:"email",style:{"margin-bottom":"15px"}},{default:$((()=>[m(s,{modelValue:u(Je).email,"onUpdate:modelValue":l[3]||(l[3]=e=>u(Je).email=e)},null,8,["modelValue"])])),_:1}),m(n,{label:"个人说明",style:{"margin-bottom":"15px"}},{default:$((()=>[m(s,{type:"textarea",placeholder:"可以是普通文本或者html",modelValue:u(Je).introduce,"onUpdate:modelValue":l[4]||(l[4]=e=>u(Je).introduce=e)},null,8,["modelValue"])])),_:1}),m(n,null,{default:$((()=>[m(w,{type:"primary",onClick:We},{default:$((()=>[J])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),m(k,{label:"修改密码",name:"second"},{default:$((()=>[m(P,{model:u(Se),ref:Xe,"status-icon":"",rules:u(Be),class:"demo-ruleForm"},{default:$((()=>[m(n,{label:"原密码",prop:"oldPass"},{default:$((()=>[m(s,{type:"password",modelValue:u(Se).oldPass,"onUpdate:modelValue":l[5]||(l[5]=e=>u(Se).oldPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(n,{label:"新密码",prop:"pass"},{default:$((()=>[m(s,{type:"password",modelValue:u(Se).pass,"onUpdate:modelValue":l[6]||(l[6]=e=>u(Se).pass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(n,{label:"确认密码",prop:"checkPass"},{default:$((()=>[m(s,{type:"password",modelValue:u(Se).checkPass,"onUpdate:modelValue":l[7]||(l[7]=e=>u(Se).checkPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(n,null,{default:$((()=>[m(w,{type:"primary",onClick:Ye},{default:$((()=>[L])),_:1}),m(w,{onClick:Ke},{default:$((()=>[Q])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),m(k,{label:"用户管理",name:"third"},{default:$((()=>[m("div",{style:{"text-align":"right",cursor:"pointer"},onClick:nl},[W,X]),m(U,{data:u(Ze),style:{width:"100%"}},{default:$((()=>[m(I,{type:"expand"},{default:$((e=>[m(a,null,{default:$((()=>[m("div",Y,[m("div",Z,[m("div",ee,[m("img",{src:u(V)(e.row.headImg),alt:""},null,8,["src"])]),m("p",le,d(e.row.nickname),1)]),m("div",te,[m("div",ae,[m("div",null,[se,m("p",null,d(e.row.createDuration),1)])]),m("div",ne,[m("div",null,[ie,m("p",null,d(e.row.email),1)])]),m("div",oe,[re,m("p",null,d(e.row.introduce),1)])])])])),_:2},1024)])),_:1}),m(I,{width:"150px",prop:"username",label:"用户名"}),m(I,{prop:"status",label:"状态"}),m(I,{label:"操作"},{default:$((e=>[m(C,{content:"设置",placement:"top"},{default:$((()=>[m("i",{class:"el-icon-setting",style:{"font-size":"20px","margin-right":"15px",cursor:"pointer"},onClick:l=>async function(e){await nl();const l=await b(`/manager/getUserImportantInfo?id=${e}`);if(200==l.code){const e=l.data;A(e,il),Object.keys(ol).forEach((e=>ol[e]=!1)),il.userPermission.length>0&&(ol.userIsIndeterminate=!0),il.settingPermission.length>0&&(ol.settingIsIndeterminate=!0),il.commentPermission.length>0&&(ol.commentIsIndeterminate=!0),il.articlePermission.length>0&&(ol.articleIsIndeterminate=!0),il.articlePermission.length===sl.articlePermission.length&&(ol.articleIsIndeterminate=!1,ol.articleCheckAll=!0),il.commentPermission.length===sl.commentPermission.length&&(ol.commentIsIndeterminate=!1,ol.commentCheckAll=!0),il.userPermission.length===sl.userPermission.length&&(ol.userIsIndeterminate=!1,ol.userCheckAll=!0),il.settingPermission.length===sl.settingPermission.length&&(ol.settingIsIndeterminate=!1,ol.settingCheckAll=!0),al.value=!0}else v.$notify.error({title:"出差啦😢！",message:l.msg})}(e.row.id)},null,8,["onClick"])])),_:2},1024),m(C,{content:"删除",placement:"top"},{default:$((()=>[m("i",{class:"el-icon-milk-tea",style:{"font-size":"20px",cursor:"pointer"},onClick:l=>async function(e){const l=await b(`/manager/delete?ids=${e}`);200==l.code?(v.$notify({title:"成功",message:"删除成功！",type:"success"}),Ze.length=0,tl().then()):v.$notify.error({title:"出差啦😢！",message:l.msg})}(e.row.id)},null,8,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])])),_:1})])),_:1},8,["modelValue"])])),_:1})]),m(y,{name:"el-fade-in-linear"},{default:$((()=>[u(al)?(o(),r(x,{key:0,onClick:l[22]||(l[22]=e=>p(al)?al.value=!1:al=!1),opacity:.5},{default:$((()=>[m(a,{class:"permission-card",onClick:l[21]||(l[21]=g((e=>p(hl)?hl.value="":hl=""),["stop"]))},{default:$((()=>[m("div",me,[m("div",ue,[ce,m(s,{placeholder:"请输入用户名",modelValue:u(il).username,"onUpdate:modelValue":l[9]||(l[9]=e=>u(il).username=e)},null,8,["modelValue"])]),m("div",de,[pe,m(s,{placeholder:"请输入密码","show-password":"",modelValue:u(il).password,"onUpdate:modelValue":l[10]||(l[10]=e=>u(il).password=e)},null,8,["modelValue"])]),m("div",ge,[fe,m(s,{placeholder:"请输入邮箱",modelValue:u(il).email,"onUpdate:modelValue":l[11]||(l[11]=e=>u(il).email=e)},null,8,["modelValue"])]),m(t,{class:"outer-divider"}),null!==u(sl).isManager&&u(sl).isManager?(o(),r("div",he,[ye,m("div",we,[Pe,m("div",ke,[m("div",ve,[m(Le,{style:{"margin-bottom":"10px"},indeterminate:u(ol).articleIsIndeterminate,modelValue:u(ol).articleCheckAll,"onUpdate:modelValue":l[12]||(l[12]=e=>u(ol).articleCheckAll=e),onChange:rl},{default:$((()=>[Ie])),_:1},8,["indeterminate","modelValue"])]),m(wl,{modelValue:u(il).articlePermission,"onUpdate:modelValue":l[13]||(l[13]=e=>u(il).articlePermission=e),onChange:dl},{default:$((()=>[(o(!0),r(f,null,h(u(sl).articlePermission,((e,l)=>(o(),r(Le,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])]),m(t),be,m("div",Ve,[m("div",Ce,[m(Le,{style:{"margin-bottom":"10px"},indeterminate:u(ol).commentIsIndeterminate,modelValue:u(ol).commentCheckAll,"onUpdate:modelValue":l[14]||(l[14]=e=>u(ol).commentCheckAll=e),onChange:ml},{default:$((()=>[_e])),_:1},8,["indeterminate","modelValue"])]),m(wl,{modelValue:u(il).commentPermission,"onUpdate:modelValue":l[15]||(l[15]=e=>u(il).commentPermission=e),onChange:pl},{default:$((()=>[(o(!0),r(f,null,h(u(sl).commentPermission,((e,l)=>(o(),r(Le,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])]),m(t),xe,m("div",Ue,[m("div",Ae,[m(Le,{style:{"margin-bottom":"10px"},indeterminate:u(ol).userIsIndeterminate,modelValue:u(ol).userCheckAll,"onUpdate:modelValue":l[16]||(l[16]=e=>u(ol).userCheckAll=e),onChange:ul},{default:$((()=>[$e])),_:1},8,["indeterminate","modelValue"])]),m(wl,{modelValue:u(il).userPermission,"onUpdate:modelValue":l[17]||(l[17]=e=>u(il).userPermission=e),onChange:gl},{default:$((()=>[(o(!0),r(f,null,h(u(sl).userPermission,((e,l)=>(o(),r(Le,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])]),m(t),je,m("div",Ee,[m("div",De,[m(Le,{style:{"margin-bottom":"10px"},indeterminate:u(ol).settingIsIndeterminate,modelValue:u(ol).settingCheckAll,"onUpdate:modelValue":l[18]||(l[18]=e=>u(ol).settingCheckAll=e),onChange:cl},{default:$((()=>[qe])),_:1},8,["indeterminate","modelValue"])]),m(wl,{modelValue:u(il).settingPermission,"onUpdate:modelValue":l[19]||(l[19]=e=>u(il).settingPermission=e),onChange:fl},{default:$((()=>[(o(!0),r(f,null,h(u(sl).settingPermission,((e,l)=>(o(),r(Le,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])])])])):c("",!0),null!==u(sl).isManager&&u(sl).isManager?(o(),r(t,{key:1,class:"outer-divider"})):c("",!0),m("div",Me,[m(w,{type:"primary",class:{"shake-horizontal":""!==u(hl)},onClick:g(yl,["stop"])},{default:$((()=>[Fe])),_:1},8,["class","onClick"]),m(w,{onClick:l[20]||(l[20]=e=>p(al)?al.value=!1:al=!1)},{default:$((()=>[Ne])),_:1}),m("span",ze,d(u(hl)),1)])])])),_:1})])),_:1},8,["opacity"])):c("",!0)])),_:1}),m(_,{isDrawer:u(Oe),onClickCallback:He},null,8,["isDrawer"])])}}});Oe.__scopeId="data-v-3f220e2a";export default Oe;
