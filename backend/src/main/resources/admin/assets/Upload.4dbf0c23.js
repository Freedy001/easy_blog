import{D as e,d as a,f as s,H as t,r as o,h as n,o as c,c as r,b as l,B as i,u,q as d,p as x,s as f,a as p,x as m}from"./vendor.d4f367cf.js";import{a as y,g,p as h}from"./http.706faa12.js";import{_ as b}from"./FullScreen.d7e9a6db.js";function C(e,a){Object.keys(e).forEach((s=>{a[s]=e[s]}))}function _(e,a){Object.keys(e).forEach((s=>{null!=e[s]?a[s]=e[s]:a[s]instanceof Array?a[s]=[]:a[s]instanceof String?a[s]="":a[s]instanceof Number?a[s]=0:a[s]instanceof Boolean?a[s]=!1:a[s]instanceof Object&&(a[s]={})}))}let v;function S(){v&&(clearTimeout(v),v=null),v=setTimeout((()=>{e.error({center:!0,customClass:"",dangerouslyUseHTMLString:!1,duration:3e3,iconClass:"",id:"",offset:0,onClose(){},type:"error",zIndex:0,showClose:!0,message:"没有权限访问！如果你是管理员可以去(用户=>用户管理=>设置)给账户添加权限！"})}),500)}const j=d();x("data-v-f0b3c0a0");const k=l("i",{class:"el-icon-upload"},null,-1),I=l("div",{class:"el-upload__text"},[f("将文件拖到此处，或"),l("em",null,"点击上传")],-1);p();var w=a({expose:[],emits:["successCB"],setup(d){a({FullScreen:b});let x={Authorization:localStorage.getItem("Authorization")};const f=s(),{proxy:p}=m(),C=f.state.userInfo.uploadMode;let _=t({}),v=o("/backend/file/upload"),S=[],w=0;async function z(a){if(C)return v.value="/backend/file/upload",!0;{x.Authorization=null;const s=await g("file////////getPolicy");if(200==s.code){const e=s.data;let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>("x"===e?16*Math.random()|0:8).toString(16)))+a.name;return _.policy=e.policy,_.signature=e.signature,_.ossaccessKeyId=e.accessid,S.push("/"+e.dir+t),w=S.length,_.key=e.dir+t,_.dir=e.dir,_.host=e.host,v.value=e.host,!0}return e({showClose:!0,message:`上传失败${s.msg}`,type:"error"}),!1}}async function A(){if(C)e("上传成功！");else{if(w--,w>0)return;const a=await h("file/uploadSuccess",S);200==a.code?(e("上传成功！"),S.length=0):e.error(a.msg)}p.$emit("successCB")}return(e,a)=>{const s=n("el-upload");return c(),r(b,{opacity:.5,index:3e3},{default:j((()=>[l(s,{onClick:a[1]||(a[1]=i((()=>{}),["stop"])),class:"upload-demo",drag:"",data:u(_),"before-upload":z,action:u(y)(u(v)),"list-type":"picture",headers:u(x),"on-success":A,multiple:""},{default:j((()=>[k,I])),_:1},8,["data","action","headers"])])),_:1},8,["opacity"])}}});w.__scopeId="data-v-f0b3c0a0";export{w as _,_ as a,C as c,S as n};
