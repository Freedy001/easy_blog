import{d as e,f as l,g as t,r as a,H as s,v as n,h as i,o,c as r,b as m,u as c,e as u,C as d,I as p,T as g,B as f,F as h,K as y,i as w,q as P,p as k,s as b,a as v,x as I}from"./vendor.d4f367cf.js";import{g as V,a as C,p as _}from"./http.379cb87b.js";import{_ as x,c as U,a as A}from"./Common.ca5a7a9a.js";import{_ as $}from"./FullScreen.589b3e35.js";import"./index.d5e32cea.js";const j=P();k("data-v-b690f64a");const E={class:"root"},D={class:"index-container"},q={class:"info"},M={key:0,class:"name"},F={class:"name"},N={class:"introduce"},O={class:"item"},T=m("i",{class:"el-icon-ice-cream-round"},null,-1),z={href:"#",style:{color:"#0b9aff","text-decoration":"none"}},H={class:"item"},R=m("i",{class:"el-icon-ice-cream-square"},null,-1),S={class:"item"},B=m("i",{class:"el-icon-lollipop"},null,-1),K=m("i",{class:"el-icon-edit"},null,-1),G={class:"statistics"},J=m("h1",null,"个人资料",-1),L=b("保存"),Q=b("提交"),W=b("重置"),X=m("i",{class:"el-icon-circle-plus-outline",style:{"margin-right":"5px"}},null,-1),Y=m("span",null,"添加一个",-1),Z={class:"expand"},ee={class:"info"},le={class:"photo"},te={class:"name"},ae={class:"introduce"},se={class:"item email"},ne=m("i",{class:"el-icon-ice-cream-square"},null,-1),ie={class:"item email"},oe=m("i",{class:"el-icon-ice-cream-square"},null,-1),re={class:"item text"},me=m("span",null,"个人介绍",-1),ce={class:"newUserForm"},ue={class:"item"},de=m("span",null,"用户名:",-1),pe={class:"item"},ge=m("span",null,"密码:",-1),fe={class:"item"},he=m("span",null,"邮箱:",-1),ye={key:0,class:"permission item"},we=m("div",{style:{width:"100%"}},[m("p",{style:{"margin-left":"10px"}},"权限:")],-1),Pe={class:"permissionContainer"},ke=m("span",null,"文章:",-1),be={class:"article line"},ve={style:{display:"flex","justify-content":"space-between"}},Ie=b("全选 "),Ve=m("span",null,"评论:",-1),Ce={class:"user line"},_e={style:{display:"flex","justify-content":"space-between"}},xe=b("全选 "),Ue=m("span",null,"用户:",-1),Ae={class:"user line"},$e={style:{display:"flex","justify-content":"space-between"}},je=b("全选 "),Ee=m("span",null,"设置:",-1),De={class:"setting line"},qe={style:{display:"flex","justify-content":"space-between"}},Me=b("全选 "),Fe={class:"item"},Ne=b("保存 "),Oe=b("取消"),Te={style:{color:"#ff268b","margin-left":"20px",width:"100%"}};v();var ze=e({expose:[],setup(P){const k=l(),b=t(),{proxy:v}=I();e({ImgDrawer:x,FullScreen:$});let ze=a(!1);function He(){ze.value=!ze.value}async function Re(e){const l=await _("/manager/updateUserInfo",{headImg:e,username:Le.username});200==l.code?(Qe().then(),k.commit("notifyReloadNickNameAndHeadImg")):v.$notify.error({title:"出差啦😢！",message:l.msg})}let Se=s({username:[{required:!0,message:"用户名不能为空",trigger:"blur"},{min:4,max:20,message:"用户名长度在 4 到 20 个字符",trigger:"blur"}],nickname:[{required:!0,message:"昵称不能为空",trigger:"blur"},{min:5,max:30,message:"昵称长度在 8 到 30 个字符！",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入正确的邮箱地址",trigger:["blur","change"]}]}),Be=s({oldPass:"",pass:"",checkPass:""}),Ke=s({oldPass:[{validator:Ge,trigger:"blur"}],pass:[{validator:Ge,trigger:"blur"}],checkPass:[{validator:function(e,l,t){Be.pass==Be.checkPass?t():t(new Error("两次输入密码不一致!"))},trigger:"blur"}]});function Ge(e,l,t){""!=l?t():t(new Error("请输入密码！"))}function Je(){Be.pass="",Be.checkPass=""}let Le=s({username:"",nickname:"",email:"",introduce:"",headImg:null,rootAdmin:!1,pageUrl:"",createDuration:"",totalArticle:0,totalCategory:0,totalTags:0,totalComment:0,totalVisit:0});n((async()=>{Qe().then()}));async function Qe(){const e=k.state.userInfo;if(0!==Object.keys(e).length)U(e,Le);else{const e=await V("/manager/getUserInfo");if(200==e.code){const l=e.data;U(l,Le)}else v.$notify.error({title:"出差啦😢！",message:e.msg})}}let We=a();function Xe(){We.value.validate((e=>{if(!e)return console.log("error submit!!"),!1;!async function(){const e=await _("/manager/updateUserInfo",{username:Le.username,nickname:Le.nickname,email:Le.email,introduce:Le.introduce});2002==e.code?(v.$notify({title:"成功",message:"修改成功，请重新登录!",type:"success"}),await b.push("/login")):200==e.code?(k.commit("notifyReloadNickNameAndHeadImg"),v.$notify({title:"成功",message:"修改成功!",type:"success"})):v.$notify.error({title:"出差啦😢！",message:e.msg})}()}))}let Ye=a();function Ze(){Ye.value.validate((async e=>{if(!e)return console.log("error submit!!"),!1;{const e=await _("/manager/updateUserPassword",{oldPassword:Be.oldPass,newPassword:Be.checkPass});2002==e.code?(v.$notify({title:"成功",message:"修改成功，请重新登录!",type:"success"}),await b.push("/login")):v.$notify.error({title:"出差啦😢！",message:e.msg})}}))}let el=s([]),ll=a("first");function tl(){"third"==ll.value&&(el.length=0,al())}async function al(){const e=await V("/manager/list??page=1&limit=20");if(200==e.code){e.page.list.forEach(((e,l)=>{el.push({id:e.id,username:e.username,nickname:e.nickname,headImg:e.headImg,email:e.email,createDuration:e.createDuration,introduce:e.introduce,status:e.status})}))}else v.$notify.error({title:"出差啦😢！",message:e.msg})}let sl=a(!1),nl=s({articlePermission:[],commentPermission:[],userPermission:[],settingPermission:[],isManager:!1});async function il(){null!=ol.id&&(ol.id=null,ol.username="",ol.password=null,ol.email="",ol.articlePermission=[],ol.commentPermission=[],ol.settingPermission=[],ol.userPermission=[],Object.keys(rl).forEach((e=>rl[e]=!1)));const e=await V("/rolePermission/getPermissionItem");if(200==e.code){sl.value=!0;const l=e.data;U(l,nl)}else v.$notify.error({title:"出差啦😢！",message:e.msg})}let ol=s({id:null,username:null,password:null,email:null,articlePermission:[],commentPermission:[],userPermission:[],settingPermission:[]}),rl=s({articleCheckAll:!1,commentCheckAll:!1,userCheckAll:!1,settingCheckAll:!1,articleIsIndeterminate:!1,commentIsIndeterminate:!1,userIsIndeterminate:!1,settingIsIndeterminate:!1});function ml(e){ol.articlePermission=e?nl.articlePermission:[],rl.articleIsIndeterminate=!1}function cl(e){ol.commentPermission=e?nl.commentPermission:[],rl.commentIsIndeterminate=!1}function ul(e){ol.userPermission=e?nl.userPermission:[],rl.userIsIndeterminate=!1}function dl(e){ol.settingPermission=e?nl.settingPermission:[],rl.settingIsIndeterminate=!1}function pl(e){let l=e.length;rl.articleCheckAll=l===nl.articlePermission.length,rl.articleIsIndeterminate=l>0&&l<nl.articlePermission.length}function gl(e){let l=e.length;rl.commentCheckAll=l===nl.commentPermission.length,rl.commentIsIndeterminate=l>0&&l<nl.commentPermission.length}function fl(e){let l=e.length;rl.userCheckAll=l===nl.userPermission.length,rl.userIsIndeterminate=l>0&&l<nl.userPermission.length}function hl(e){let l=e.length;rl.settingCheckAll=l===nl.settingPermission.length,rl.settingIsIndeterminate=l>0&&l<nl.settingPermission.length}let yl=a("");async function wl(){try{!function(){if(null!=ol.id){if(null!=ol.password&&(ol.password.length<8||ol.password.length>20))throw yl.value="密码长度在 8 到 20 个字符！",new Error;if(!ol.email.match("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"))throw yl.value="邮箱格式不正确~~ 😥😥",new Error}else{if(!(Pl(ol.username)&&Pl(ol.email)&&Pl(ol.password)))throw yl.value="用户名密码邮箱都不能为空哦！",new Error;if(ol.username.length<4||ol.username.length>20)throw yl.value="用户名长度在 4 到 20 个字符！",new Error;if(ol.password.length<8||ol.password.length>20)throw yl.value="密码长度在 8 到 20 个字符！",new Error;if(!ol.email.match("^\\w+([-+.]\\w+)*@\\w+([-.]\\w+)*\\.\\w+([-.]\\w+)*$"))throw yl.value="邮箱格式不正确~~ 😥😥",new Error}}();const e=await _("/manager/createOrUpdateManager",ol);200==e.code?(v.$notify({title:"成功",message:"操作成功！",type:"success"}),el.length=0,al().then(),sl.value=!1,ol.id=null,ol.username=null,ol.password=null,ol.email=null,ol.articlePermission=[],ol.commentPermission=[],ol.userPermission=[],ol.settingPermission=[]):2002==e.code?(v.$notify({title:"成功",message:"修改成功，请重新登录!",type:"success"}),await b.push("/login")):v.$notify.error({title:"出差啦😢！",message:e.msg,duration:5e3})}catch(e){}}function Pl(e){return null!=e&&e.length>0}return(e,l)=>{const t=i("el-divider"),a=i("el-card"),s=i("el-input"),n=i("el-form-item"),P=i("el-button"),k=i("el-form"),b=i("el-tab-pane"),I=i("el-table-column"),_=i("el-tooltip"),U=i("el-table"),Ge=i("el-tabs"),Qe=i("el-checkbox"),Pl=i("el-checkbox-group");return o(),r("div",E,[m("div",D,[m(a,{class:"box-card left"},{default:j((()=>[m("div",q,[m("div",{class:"photo",onClick:He,style:{cursor:"pointer"}},[m("img",{src:c(C)(c(Le).headImg),alt:""},null,8,["src"])]),c(Le).rootAdmin?(o(),r("p",M,"Admin")):u("",!0),m("p",F,d(c(Le).nickname),1)]),m("div",N,[m("div",O,[T,m("a",z," http://localhost:3000"+d(c(Le).pageUrl),1)]),m("div",H,[R,m("p",null,d(c(Le).email),1)]),m("div",S,[B,m("p",null,d(c(Le).createDuration),1)])]),m(t,null,{default:j((()=>[K])),_:1}),m("div",G,[m("p",null,"累计发表了 "+d(c(Le).totalArticle)+" 篇文章。",1),m(t),m("p",null,"累计创建了 "+d(c(Le).totalCategory)+" 个分类。",1),m(t),m("p",null,"累计创建了 "+d(c(Le).totalTags)+" 个标签。",1),m(t),m("p",null,"累计获得了 "+d(c(Le).totalComment)+" 条评论。",1),m(t),m("p",null,"文章总阅读 "+d(c(Le).totalVisit)+" 次。",1),m(t)])])),_:1}),m(a,{class:"box-card right"},{default:j((()=>[J,m(Ge,{modelValue:c(ll),"onUpdate:modelValue":l[8]||(l[8]=e=>p(ll)?ll.value=e:ll=e),onTabClick:tl},{default:j((()=>[m(b,{label:"基本资料",name:"first"},{default:j((()=>[m(k,{ref:We,model:c(Le),rules:c(Se)},{default:j((()=>[m(n,{label:"登录用户名",prop:"username",style:{"margin-bottom":"15px"}},{default:j((()=>[m(s,{modelValue:c(Le).username,"onUpdate:modelValue":l[1]||(l[1]=e=>c(Le).username=e)},null,8,["modelValue"])])),_:1}),m(n,{label:"昵称 (不建议经常更改,可能会影响性能)",prop:"nickname",style:{"margin-bottom":"15px"}},{default:j((()=>[m(s,{modelValue:c(Le).nickname,"onUpdate:modelValue":l[2]||(l[2]=e=>c(Le).nickname=e)},null,8,["modelValue"])])),_:1}),m(n,{label:"电子邮件",prop:"email",style:{"margin-bottom":"15px"}},{default:j((()=>[m(s,{modelValue:c(Le).email,"onUpdate:modelValue":l[3]||(l[3]=e=>c(Le).email=e)},null,8,["modelValue"])])),_:1}),m(n,{label:"个人说明",style:{"margin-bottom":"15px"}},{default:j((()=>[m(s,{type:"textarea",placeholder:"可以是普通文本或者html",modelValue:c(Le).introduce,"onUpdate:modelValue":l[4]||(l[4]=e=>c(Le).introduce=e)},null,8,["modelValue"])])),_:1}),m(n,null,{default:j((()=>[m(P,{type:"primary",onClick:Xe},{default:j((()=>[L])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),m(b,{label:"修改密码",name:"second"},{default:j((()=>[m(k,{model:c(Be),ref:Ye,"status-icon":"",rules:c(Ke),class:"demo-ruleForm"},{default:j((()=>[m(n,{label:"原密码",prop:"oldPass"},{default:j((()=>[m(s,{type:"password",modelValue:c(Be).oldPass,"onUpdate:modelValue":l[5]||(l[5]=e=>c(Be).oldPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(n,{label:"新密码",prop:"pass"},{default:j((()=>[m(s,{type:"password",modelValue:c(Be).pass,"onUpdate:modelValue":l[6]||(l[6]=e=>c(Be).pass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(n,{label:"确认密码",prop:"checkPass"},{default:j((()=>[m(s,{type:"password",modelValue:c(Be).checkPass,"onUpdate:modelValue":l[7]||(l[7]=e=>c(Be).checkPass=e),autocomplete:"off"},null,8,["modelValue"])])),_:1}),m(n,null,{default:j((()=>[m(P,{type:"primary",onClick:Ze},{default:j((()=>[Q])),_:1}),m(P,{onClick:Je},{default:j((()=>[W])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1}),m(b,{label:"用户管理",name:"third"},{default:j((()=>[m("div",{style:{"text-align":"right",cursor:"pointer"},onClick:il},[X,Y]),m(U,{data:c(el),style:{width:"100%"}},{default:j((()=>[m(I,{type:"expand"},{default:j((e=>[m(a,null,{default:j((()=>[m("div",Z,[m("div",ee,[m("div",le,[m("img",{src:c(C)(e.row.headImg),alt:""},null,8,["src"])]),m("p",te,d(e.row.nickname),1)]),m("div",ae,[m("div",se,[m("div",null,[ne,m("p",null,d(e.row.createDuration),1)])]),m("div",ie,[m("div",null,[oe,m("p",null,d(e.row.email),1)])]),m("div",re,[me,m("p",null,d(e.row.introduce),1)])])])])),_:2},1024)])),_:1}),m(I,{width:"150px",prop:"username",label:"用户名"}),m(I,{prop:"status",label:"状态"}),m(I,{label:"操作"},{default:j((e=>[m(_,{content:"设置",placement:"top"},{default:j((()=>[m("i",{class:"el-icon-setting",style:{"font-size":"20px","margin-right":"15px",cursor:"pointer"},onClick:l=>async function(e){await il();const l=await V(`/manager/getUserImportantInfo?id=${e}`);if(200==l.code){const e=l.data;A(e,ol),Object.keys(rl).forEach((e=>rl[e]=!1)),ol.userPermission.length>0&&(rl.userIsIndeterminate=!0),ol.settingPermission.length>0&&(rl.settingIsIndeterminate=!0),ol.commentPermission.length>0&&(rl.commentIsIndeterminate=!0),ol.articlePermission.length>0&&(rl.articleIsIndeterminate=!0),ol.articlePermission.length===nl.articlePermission.length&&(rl.articleIsIndeterminate=!1,rl.articleCheckAll=!0),ol.commentPermission.length===nl.commentPermission.length&&(rl.commentIsIndeterminate=!1,rl.commentCheckAll=!0),ol.userPermission.length===nl.userPermission.length&&(rl.userIsIndeterminate=!1,rl.userCheckAll=!0),ol.settingPermission.length===nl.settingPermission.length&&(rl.settingIsIndeterminate=!1,rl.settingCheckAll=!0),sl.value=!0}else v.$notify.error({title:"出差啦😢！",message:l.msg})}(e.row.id)},null,8,["onClick"])])),_:2},1024),m(_,{content:"删除",placement:"top"},{default:j((()=>[m("i",{class:"el-icon-milk-tea",style:{"font-size":"20px",cursor:"pointer"},onClick:l=>async function(e){const l=await V(`/manager/delete?ids=${e}`);200==l.code?(v.$notify({title:"成功",message:"删除成功！",type:"success"}),el.length=0,al().then()):v.$notify.error({title:"出差啦😢！",message:l.msg})}(e.row.id)},null,8,["onClick"])])),_:2},1024)])),_:1})])),_:1},8,["data"])])),_:1})])),_:1},8,["modelValue"])])),_:1})]),(o(),r(g,{to:"body"},[m(w,{name:"el-fade-in-linear"},{default:j((()=>[c(sl)?(o(),r($,{key:0,onClick:l[22]||(l[22]=e=>p(sl)?sl.value=!1:sl=!1),opacity:.5},{default:j((()=>[m(a,{class:"permission-card",onClick:l[21]||(l[21]=f((e=>p(yl)?yl.value="":yl=""),["stop"]))},{default:j((()=>[m("div",ce,[m("div",ue,[de,m(s,{placeholder:"请输入用户名",modelValue:c(ol).username,"onUpdate:modelValue":l[9]||(l[9]=e=>c(ol).username=e)},null,8,["modelValue"])]),m("div",pe,[ge,m(s,{placeholder:"请输入密码","show-password":"",modelValue:c(ol).password,"onUpdate:modelValue":l[10]||(l[10]=e=>c(ol).password=e)},null,8,["modelValue"])]),m("div",fe,[he,m(s,{placeholder:"请输入邮箱",modelValue:c(ol).email,"onUpdate:modelValue":l[11]||(l[11]=e=>c(ol).email=e)},null,8,["modelValue"])]),m(t,{class:"outer-divider"}),null!==c(nl).isManager&&c(nl).isManager?(o(),r("div",ye,[we,m("div",Pe,[ke,m("div",be,[m("div",ve,[m(Qe,{style:{"margin-bottom":"10px"},indeterminate:c(rl).articleIsIndeterminate,modelValue:c(rl).articleCheckAll,"onUpdate:modelValue":l[12]||(l[12]=e=>c(rl).articleCheckAll=e),onChange:ml},{default:j((()=>[Ie])),_:1},8,["indeterminate","modelValue"])]),m(Pl,{modelValue:c(ol).articlePermission,"onUpdate:modelValue":l[13]||(l[13]=e=>c(ol).articlePermission=e),onChange:pl},{default:j((()=>[(o(!0),r(h,null,y(c(nl).articlePermission,((e,l)=>(o(),r(Qe,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])]),m(t),Ve,m("div",Ce,[m("div",_e,[m(Qe,{style:{"margin-bottom":"10px"},indeterminate:c(rl).commentIsIndeterminate,modelValue:c(rl).commentCheckAll,"onUpdate:modelValue":l[14]||(l[14]=e=>c(rl).commentCheckAll=e),onChange:cl},{default:j((()=>[xe])),_:1},8,["indeterminate","modelValue"])]),m(Pl,{modelValue:c(ol).commentPermission,"onUpdate:modelValue":l[15]||(l[15]=e=>c(ol).commentPermission=e),onChange:gl},{default:j((()=>[(o(!0),r(h,null,y(c(nl).commentPermission,((e,l)=>(o(),r(Qe,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])]),m(t),Ue,m("div",Ae,[m("div",$e,[m(Qe,{style:{"margin-bottom":"10px"},indeterminate:c(rl).userIsIndeterminate,modelValue:c(rl).userCheckAll,"onUpdate:modelValue":l[16]||(l[16]=e=>c(rl).userCheckAll=e),onChange:ul},{default:j((()=>[je])),_:1},8,["indeterminate","modelValue"])]),m(Pl,{modelValue:c(ol).userPermission,"onUpdate:modelValue":l[17]||(l[17]=e=>c(ol).userPermission=e),onChange:fl},{default:j((()=>[(o(!0),r(h,null,y(c(nl).userPermission,((e,l)=>(o(),r(Qe,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])]),m(t),Ee,m("div",De,[m("div",qe,[m(Qe,{style:{"margin-bottom":"10px"},indeterminate:c(rl).settingIsIndeterminate,modelValue:c(rl).settingCheckAll,"onUpdate:modelValue":l[18]||(l[18]=e=>c(rl).settingCheckAll=e),onChange:dl},{default:j((()=>[Me])),_:1},8,["indeterminate","modelValue"])]),m(Pl,{modelValue:c(ol).settingPermission,"onUpdate:modelValue":l[19]||(l[19]=e=>c(ol).settingPermission=e),onChange:hl},{default:j((()=>[(o(!0),r(h,null,y(c(nl).settingPermission,((e,l)=>(o(),r(Qe,{key:l,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"])])])])):u("",!0),null!==c(nl).isManager&&c(nl).isManager?(o(),r(t,{key:1,class:"outer-divider"})):u("",!0),m("div",Fe,[m(P,{type:"primary",class:{"shake-horizontal":""!==c(yl)},onClick:f(wl,["stop"])},{default:j((()=>[Ne])),_:1},8,["class","onClick"]),m(P,{onClick:l[20]||(l[20]=e=>p(sl)?sl.value=!1:sl=!1)},{default:j((()=>[Oe])),_:1}),m("span",Te,d(c(yl)),1)])])])),_:1})])),_:1},8,["opacity"])):u("",!0)])),_:1})])),m(x,{isDrawer:c(ze),onClickCallback:Re},null,8,["isDrawer"])])}}});ze.__scopeId="data-v-b690f64a";export default ze;
